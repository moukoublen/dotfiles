#!/usr/bin/env bash

update_dnf() {
    echo -e "\e[0;96m->\e[0m \e[0;90msudo dnf update --refresh\e[0m"
    sudo dnf update --refresh
    sudo dnf needs-restarting --reboothint
}

update_apt() {
    echo -e "\e[0;96m->\e[0m \e[0;90msudo apt update\e[0m"
    sudo apt update
    echo -e "\e[0;96m->\e[0m \e[0;90msudo apt upgrade\e[0m"
    sudo apt upgrade
    [[ -e /var/run/reboot-required ]] && echo -e "\e[0;96m->\e[0m \e[0;97mreboot is required\e[0m"
}

echo -e "\e[1;96m$(what-os)\e[0m with \e[1;36m$(what-pm)\e[0m"
case "$(what-pm)" in
  "dnf")
    update_dnf
    ;;
  "apt")
    update_apt
    ;;
  *)
    prnt "this script does not have update command for this release"
    ;;
esac

unset -f update_dnf
unset -f update_apt



if command -v snap &> /dev/null
then
  (set -ex
  sudo snap refresh
  snap-clean-disabled
  )
fi

if command -v flatpak &> /dev/null
then
  (set -ex
  sudo flatpak update
  )
fi

if command -v brew &> /dev/null
then
  (set -ex
  brew update
  brew upgrade
  brew cleanup
  )
fi

"${DOTFILES_PATH}"/scripts/install-docker-buildx
"${DOTFILES_PATH}"/scripts/install-docker-compose
"${DOTFILES_PATH}"/scripts/install-starship
"${DOTFILES_PATH}"/scripts/install-bat
"${DOTFILES_PATH}"/scripts/install-fzf
"${DOTFILES_PATH}"/scripts/install-delta
"${DOTFILES_PATH}"/scripts/install-elastic-package
"${DOTFILES_PATH}"/scripts/install-helm
"${DOTFILES_PATH}"/scripts/install-k9s
"${DOTFILES_PATH}"/scripts/install-kind
"${DOTFILES_PATH}"/scripts/install-minikube
# "${DOTFILES_PATH}"/scripts/install-dbeaver
